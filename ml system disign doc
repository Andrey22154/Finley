# Дизайн ML системы - Прогнозирование цен акций S&P 500

## 1. Цели и предпосылки

### 1.1. Зачем идем в разработку продукта?

#### Бизнес-цель

Целью данного проекта является предоставление пользователям прогнозов цен акций компаний из списка S&P 500, что позволит им принимать более информированные инвестиционные решения. Ключевые задачи включают предоставление актуальных прогнозов, снижение риска для инвесторов и улучшение пользовательского опыта.

#### Почему станет лучше, чем сейчас, от использования ML

Использование машинного обучения позволит улучшить качество прогнозов цен акций по сравнению с традиционными методами анализа. ML-модель будет обучаться на исторических данных и сможет выявлять сложные паттерны и зависимости, которые недоступны для традиционного анализа. Это позволит предоставлять более точные прогнозы и адаптироваться к изменениям на рынке.

#### Что будем считать успехом с точки зрения бизнеса

Для измерения критерия успеха используем следующие ключевые показатели:

- Увеличение количества активных пользователей бота.
- Улучшение пользовательского опыта за счет предоставления удобных и точных прогнозов.
- Увеличение доверия пользователей к прогнозам.

#### Стоимость

Затраты на инфраструктуру ML-моделей:

- Это включает расходы на необходимую инфраструктуру для развертывания и работы ML-моделей, такие как вычислительные ресурсы, хранение данных и обеспечение безопасности.

### 1.2. Бизнес-требования и ограничения

#### Краткое описание бизнес-требований

Проект направлен на повышение эффективности прогнозирования цен акций компаний из списка S&P 500 путем внедрения ML-решения. Бизнес-требования включают создание и интеграцию модели, которая может обрабатывать входные данные о ценах акций и предоставлять точные прогнозы на различные периоды (день, неделя, месяц).

#### Интерпретируемость модели

Требуется для понимания работы модели и обеспечения доверия пользователей. Интерпретируемость также важна для анализа ошибок и поиска путей улучшения модели.

#### Бизнес-ограничения

- Ограниченное количество ресурсов для обработки и хранения данных.
- Необходимость обеспечения высокой точности прогнозов.
- Минимизация времени обработки запросов для обеспечения быстрого отклика бота.

#### Описание бизнес-процесса пилота

После разработки и тестирования ML-модель будет интегрирована в Telegram бота. Входные данные о ценах акций будут подаваться на вход модели, которая будет генерировать прогнозы на различные периоды. Прогнозы будут сохраняться в базе данных PostgreSQL и обновляться три раза в день. Пользователи смогут запрашивать прогнозы через бот, и бот будет предоставлять их из базы данных.

### 1.3. Предпосылки решения

#### Данные

Наше решение будет базироваться на данных о ценах акций, предоставляемых через API yfinance. Мы предполагаем, что эти данные достаточно полны и точны для обучения модели машинного обучения.

#### Горизонт прогноза или режим работы

Прогнозы будут генерироваться для различных горизонтов времени (день, неделя, месяц) и обновляться три раза в день.

#### Гранулярность модели

Модель будет работать на уровне отдельных акций, анализируя каждую акцию по отдельности.

#### Процесс

Модель будет интегрирована в Telegram бота, который будет работать совместно с базой данных PostgreSQL для хранения и предоставления прогнозов.

### 1.4. Бизнес-метрики

Основной метрикой успеха будет точность прогнозов. Мы будем измерять следующие показатели:

- Symmetric Mean Absolute Percentage Error (SMAPE)

Эти метрики будут агрегированы для оценки общей точности модели.

## 2. Методология

### 2.1. Постановка задачи

Задача регрессии - прогноз стоимости акций на разную дистнацию времени.

### 2.2. Блок-схема решения

(Нет)

### 2.3. Этапы решения задачи

#### 2.3.1 Выбор метрик

Оффлайн-метрики:

- Mean Absolute Error (MAE)
- Root Mean Squared Error (RMSE)
- Symmetric Mean Absolute Percentage Error (SMAPE)

Онлайн метрики:

- Количество запросов прогнозов через бота.
- Время отклика на запросы.
- Сравнение прогнозных значений и значений, уже ставших известными

Технические метрики:

- Скорость обработки данных и генерации прогнозов.
- Нагрузка на сервер.

#### 2.3.2 Определение объекта и таргета

Объект - акции компаний из списка S&P 500.
Целевая переменная: прогнозируемая цена акции.

#### 2.3.3 Сбор данных

Данные будут собраны через API yfinance для всех акций из списка S&P 500. Исторические данные за последние 6 месяцев будут использованы для обучения модели.

#### 2.3.4 Подготовка данных

Данные будут очищены и проверены на наличие пропусков. Будут рассчитаны необходимые технические индикаторы и признаки для модели.

#### 2.3.5 Оценка поведения baseline

Будет разработана базовая модель для оценки начального уровня точности прогнозов.

#### 2.3.6 Подготовка тренировочного и тестового наборов данных

Данные будут разделены на тренировочный и тестовый наборы для оценки производительности модели.

#### 2.3.7 Валидация

Будет использоваться валидация на основе временных рядов для обеспечения реалистичной оценки производительности модели.

#### 2.3.8 Выбор архитектуры модели для решения задачи

Будет использоваться модель CatBoost для прогнозирования цен акций. Модель будет обучаться на исторических данных и использовать различные технические индикаторы.

#### 2.3.9 Методы интерпретации

Будут использоваться методы интерпретации моделей для анализа значимости признаков и выявления паттернов.

#### 2.3.10 Анализ ошибок

Будет проведен анализ ошибок модели для выявления слабых мест и поиска путей улучшения.

## 3. Подготовка пилота

### 3.1. Способ оценки пилота

Для оценки пилота будут использованы метрики точности (MAE, RMSE, SMAPE) и обратная связь от пользователей.

### 3.2. Что считаем успешным пилотом

Успешным пилотом будет считаться положительная оценка точности прогнозов и увеличение количества активных пользователей бота.

## 4. Внедрение

### 4.1. Архитектура решения

Архитектура будет включать ML-модель, базу данных PostgreSQL и Telegram бот.

### 4.2. Описание инфраструктуры и масштабируемости

Инфраструктура будет включать сервер для развертывания модели и базы данных, а также обеспечение масштабируемости для обработки большого количества запросов.

### 4.3. Требования к работе системы

Система должна обеспечивать высокую точность прогнозов и быстрый отклик на запросы пользователей.

### 4.4. Издержки

Расчетные издержки включают зарплаты для 3 ML специалистов и затраты на инфраструктуру.

### 4.5. Риски

- Риск пропуска важных рыночных событий.
- Технические сбои в работе модели или сервера.
- Высокая нагрузка на сервер в периоды пиковых запросов.
- Отсутствие учета макроэкономических факторов
